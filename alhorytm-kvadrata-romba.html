<!DOCTYPE html>
<html>
	<head lang="uk">
		<meta charset="utf-8"/>
		<title>Алгоритм квадрата-ромба</title>
		<style>
:root { --accent: #8ec07c; }
		</style>
		<link rel="stylesheet" href="style.css">
		<link rel="icon" href="images/icon.svg">
		<meta name="author" content="serhiy help">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="
					Блог зі статтями на різні цікаві теми:
					програмування, алгоритми, процедурна генерація, математика, геометрія.">
	</head>
	<body>
		<header>
			<a href="index.html"><img src="images/icon.svg" alt="На головну" height=30em /></a>
		</header>
		<main>
			<h1>Алгоритм квадрата-ромба</h1>
<h2>Алгоритм зміщення серединної точки</h2>
<p>Перш ніж вести мову за алгоритм квадрата-ромба
варто розібратись з <em>алгоритмом зміщення серединної точки</em> (midpoint displasement).
Найпростіший варіант цього алгоритму працює зі списком висот.
Він підходить для того, щоб створити ландшафт для 2D гри або для створення лінії обрію.</p>
<p><img src="images/midpoint-displasement.webp" alt="Анімація виконання алгоритму" /></p>
<h3>Як працює алгоритм</h3>
<p>Списки висот, які утворює цей алгоритм,
мають довжину 2<sup>n</sup>+1.
Щоби зробити ландшафт іншої довжини,
можна згенерувати ландшафт більшого розміру та обрізати його частину.</p>
<p>Спершу, ми почнімо зі списку вершин, який містить два елемента —
їх значення будуть висотами по краям землі.
Потім, додаймо новий елемент до списку між ними.
Значення цього елемента буде дорівнювати середньому арифметичному значень елементів між якими він знаходиться
плюс випадкове зміщення.
Величина цього зміщення залежить від ітерації алгоритму: з кожною ітерацією вона падає.
На мою думку, найкраще, коли вона падає в геометричній прогресії - в два рази на кожній ітерації.</p>
<p>Тепер, після того як ми додали нову вершину, наш список містить три вершини,
а значить — алгоритм закінчив свою першу ітерацію.</p>
<p>Далі, на другій ітерації, ми повинні вставити нові вершини між старими,
розширивши список до п'яти вершин.
Значення цих вершин обраховується у спосіб зазначений вище.</p>
<p>Так можна продовжувати далі, ітерація за ітерацією.
Додаючи нові деталі до ландшафту.</p>
<h3>Реалізація</h3>
<p>Наведений код написаний на мові GDScript.</p>
<pre><code><span class="word">func</span> generate(subdivisions: int, roughness: float, land_seed: int) -&gt; Array:
	<span class="word">var</span> random = RandomNumberGenerator.new()
	random.seed = land_seed

	<span class="word">var</span> land: Array = []

	<span class="comment"># Крайні точки списку</span>
	land.append(randf())
	land.append(randf())

	<span class="word">for</span> n <span class="word">in</span> subdivisions:
		<span class="word">var</span> i: int = 0
		<span class="word">while</span> i &lt; land.size() - 1:
			<span class="word">var</span> left = land[i]
			<span class="word">var</span> right = land[i + 1]
			<span class="word">var</span> mid = (left + right) * 0.5
			<span class="comment"># roughness — множник, який регулює шершавість</span>
			<span class="comment"># На анімації вище roughness = 0.2</span>
			mid += random.randfn() / pow(2, n) * roughness
			<span class="comment">#нова точна вставляється між старими</span>
			land.insert(i + 1, mid)
			<span class="comment"># індекс потрібно збільшити на 2 так як з'явився новий елемент</span>
			i += 2

	<span class="word">return</span> land
</code></pre>
<h2>Алгоритм зміщення серединної точки (двовимірний)</h2>
<p>Розширена версія алгоритму працює для прямокутників зі сторонами 2<sup>n</sup>+1.
Взагалі, алгоритм можна доповнювати далі, для роботи з вищими розмірностями.
У такий спосіб можна генерувати печери, туманності та хмари газу.</p>
<p>Якщо раніше ми розглядали відрізок на двох точках, який ми розбивали на два нових відрізка,
то тепер, ми працюємо з квадратом, який ми маємо розбити на чотири нових.
Для цього нам потрібно знайти одну точку в центрі квадрата, та чотири - на ребрах.
Значення центральної точки дорівнює середньому арифметичному значень кутових точок плюс зміщення.
Зміщення шукається так само як і в оригінальній версії алгоритму.
Значення ж точок на ребрах — це середнє значення <strong>двох</strong> точок на прилеглих до ребра кутах плюс зміщення.</p>
<h2>Власне алгоритм квадрата-ромба</h2>
<p>В землях згенерованих алгоритмом зміщення серединної точки
деякі точки отримають своє значення на основі значень чотирьох інших точок а деякі - на основі двох.
Тому, якщо поглянути на результат роботи цього алгоритму в очі відразу кидаються ромбовидні структури, що утворюються на поверхні.
Як спосіб вирішити цю проблему був створений алгоритм <em>квадрата-ромба</em> (diamond-square).</p>
<p>Кожна ітерація цього алгоритму проходить у два етапи:
На першому ми знаходимо середини всіх квадратів, використовуючи значення всіх чотирьох кутів.
На другому - ми знаходимо точки на ребрах.
Їх значення визначається на основі двох точок на кутах квадрата,
а також на основі двох центрів в квадратах що містять ребро з нашою точкою.</p>
<p>По краям карти нашим точкам немає звідки взяти четверте значення.
Існує декілька способів вирішити цю проблему.
Можна просто проігнорувати четверту точку і взяти середнє арифметичне від трьох значень.
А можна, взяти її значення як рівне нулю, або взяти значення точки з протилежного кінця карти.
Тоді карта буде зацикленою і топологічно буде дорівнювати тору.</p>

<div class="cycle-reference"> Стаття з циклу: <a href="index.html#heneratsiia-landshaftu">Генерація ландшафту</a> </div>
<nav>
    
    <a class="btn" href="shum-perlina.html">Наступна стаття</a>

</nav>

		</main>
		<footer>
			<div>
				Підтримай автора:
				<ul>
					<li>
						<a href="https://privatbank.ua/sendmoney?payment=4f11f2ed6d">
							<img class="icon" alt="privat" src="images/privat.svg">ПриватБанк Sendmoney
						</a>
					</li>
				</ul>
			</div>
			<div>
				Є питання чи пропозиції?
				<ul>
					<li>
						<a href="mailto:sergiyhelp@gmail.com">
							<img class="icon" alt="email" src="images/email.svg">sergiyhelp@gmail.com
						</a>
					</li>
				</ul>
			</div>
			<div>
				Подпишись на новини:
				<ul>
					<li>
						<a href="https://t.me/prykoliakhy">
							<img class="icon" alt="tg" src="images/telegram.svg">Telegram
						</a>
					</li>
				</ul>
			</div>
		</footer>
	</body>
</html>
